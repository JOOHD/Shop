<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¥ë°”êµ¬ë‹ˆ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">ì¥ë°”êµ¬ë‹ˆ</h2>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>ì„ íƒ</th>
            <th>ìƒí’ˆëª…</th>
            <th>ìˆ˜ëŸ‰</th>
            <th>ê°€ê²©</th>
        </tr>
        </thead>
        <tbody id="cartItems">
        <!-- ğŸ’¡ í…ŒìŠ¤íŠ¸ìš© ê³ ì • ìƒí’ˆ -->
        <tr>
            <td><input type="checkbox" class="cart-check" data-id="999" data-price="10000" checked></td>
            <td>í…ŒìŠ¤íŠ¸ ìƒí’ˆ</td>
            <td>2</td>
            <td>10,000ì›</td>
        </tr>
        </tbody>
    </table>

    <div class="text-end">
        <strong>ì´ ê²°ì œ ê¸ˆì•¡: <span id="totalPrice">0</span>ì›</strong>
    </div>

    <button id="goOrderBtn" class="btn btn-primary mt-3">ì£¼ë¬¸í•˜ê¸°</button>
</div>

<script>
  let totalPrice = 0;

  // ğŸ’¡ í…ŒìŠ¤íŠ¸ ë°ì´í„° ê¸°ì¤€ ì´ ê¸ˆì•¡ ê³„ì‚°
  function calculateTotal() {
    const checkboxes = document.querySelectorAll(".cart-check:checked");
    totalPrice = Array.from(checkboxes).reduce((sum, cb) => sum + Number(cb.dataset.price), 0);
    document.getElementById("totalPrice").textContent = totalPrice.toLocaleString();
  }

  calculateTotal(); // í˜ì´ì§€ ë¡œë“œ ì‹œ 1íšŒ ì‹¤í–‰

  document.addEventListener("change", function (e) {
    if (e.target.classList.contains("cart-check")) {
      calculateTotal();
    }
  });

  document.getElementById("goOrderBtn").addEventListener("click", function () {
    const selectedIds = Array.from(document.querySelectorAll(".cart-check:checked")).map(cb => Number(cb.dataset.id));
    if (selectedIds.length === 0) {
      alert("ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    const orderDto = {
      cartIds: selectedIds,
      totalPrice: totalPrice,
      payMethod: "CARD",
      ordererName: "í…ŒìŠ¤íŠ¸ìœ ì €",
      phoneNumber: "01012345678",
      address: "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ê°•ë‚¨ëŒ€ë¡œ 123",
      detailAddress: "í…ŒìŠ¤íŠ¸ë¹Œë”© 5ì¸µ",
      postCode: "06236"
    };

    sessionStorage.setItem("orderDto", JSON.stringify(orderDto));
    alert("í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
    window.location.href = "/order";
  });

  // ===========================
  // âœ… ì„œë²„ ì—°ë™ í…ŒìŠ¤íŠ¸ ì‹œ ì£¼ì„ í•´ì œ
  /*
  const memberId = 1;
  const apiUrl = `/api/v1/cart/${memberId}`;
  let cartData = [];

  fetch(apiUrl)
    .then(response => response.json())
    .then(data => {
      cartData = data;
      const tbody = document.getElementById("cartItems");
      tbody.innerHTML = ""; // ê¸°ì¡´ ê³ ì •ê°’ ì œê±°

      data.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input type="checkbox" class="cart-check" data-id="${item.cartId}" data-price="${item.price}" checked></td>
          <td>${item.productName}</td>
          <td>${item.quantity}</td>
          <td>${Number(item.price).toLocaleString()}ì›</td>
        `;
        tbody.appendChild(row);
      });

      calculateTotal();
    });
  */
</script>
</body>
</html>
