<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Header</title>
  <link rel="stylesheet" th:href="@{/css/header.css}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<header class="header-bar" th:fragment="header">

  <div class="left-icons">
    <i class="fas fa-bars" title="메뉴" onclick="toggleSidebar()"></i>
    <i class="fas fa-search" title="검색" onclick="toggleSearchSidebar()"></i>
  </div>

  <div class="header-center">
    <a href="/" class="header-logo-link"><img class="logo" src="/logo/icons/mufc_icon.png" alt="MUFC 로고"/></a>
  </div>

  <div class="right-icons">
    <div class="login-container">
      <!-- 비로그인 -->
      <div th:if="${!loggedIn}">
        <a href="/login" title="로그인" id="login-link"><i class="fas fa-user icon-btn"></i></a>
        <div id="loginModal" class="login-modal">
          <p>계정이 없으신가요? <a href="/join">회원가입</a></p>
        </div>
      </div>

      <!-- 로그인 -->
      <div th:if="${loggedIn}">
        <i class="fas fa-user-circle icon-btn" title="마이페이지" id="mypageIcon"></i>
        <div id="mypageModal" class="login-modal">
          <a href="/profile">내 정보</a>
          <a href="/orders">주문 내역</a>
          <a href="/wishlist">위시리스트</a>
          <a href="/cart">장바구니</a>
          <a href="/logout">로그아웃</a>
        </div>
      </div>
    </div>
  </div>

</header>

<script>
function toggleSidebar() { console.log('사이드바 토글'); }
function toggleSearchSidebar() { console.log('검색 토글'); }

document.addEventListener('DOMContentLoaded', () => {
    const mypageIcon = document.getElementById('mypageIcon');
    const mypageModal = document.getElementById('mypageModal');

    if(mypageIcon && mypageModal){
        // 클릭 시 토글
        mypageIcon.addEventListener('click', (e) => {
            e.stopPropagation();
            const style = window.getComputedStyle(mypageModal);
            mypageModal.style.display = (style.display === 'none') ? 'block' : 'none';
        });

        // 외부 클릭 시 닫기
        document.addEventListener('click', (e) => {
            if(!mypageIcon.contains(e.target) && !mypageModal.contains(e.target)){
                mypageModal.style.display = 'none';
            }
        });
    }

    // 비로그인 로그인 아이콘 클릭 시 이동
    const loginLink = document.getElementById('login-link');
    if(loginLink){
        loginLink.addEventListener('click', (e) => {
            // preventDefault 제거 → 링크 정상 이동
        });
    }
});
</script>

</body>
</html>
