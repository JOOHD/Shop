<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>로그인</title>
    <link rel="stylesheet" href="/css/login.css" />
</head>
<body>
<div class="login-container">
    <div class="modal-overlay show" id="modalOverlay"></div>

    <div class="login-modal show" id="loginModal">
        <div class="modal-header">
            <span class="back-button" title="뒤로 가기">&#8592;</span>
        </div>

        <div class="modal-body">
            <form id="formLogin" method="post" action="/formLogin">
                <label><input type="email" id="username" name="username" placeholder="이메일 주소" required /></label>
                <label><input type="password" id="password" name="password" placeholder="비밀번호" required /></label>
                <input type="hidden" name="_csrf" value="${_csrf.token}" />
                <button type="submit" class="submit-btn">로그인</button>
            </form>

            <div class="find-links">
                <a href="#">이메일 가입</a>
                <span>|</span>
                <a href="#">이메일 찾기</a>
                <span>|</span>
                <a href="#">비밀번호 찾기</a>
            </div>

            <div class="social-login">
                <button id="kakaoLoginBtn" type="button" aria-label="카카오 로그인">
                    <img src="/logo/icons/kakao_login_button.png" alt="카카오 로그인" />
                </button>
                <button id="naverLoginBtn" type="button" aria-label="네이버 로그인">
                    <img src="/logo/icons/naver_login_button.png" alt="네이버 로그인" />
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const backButton = document.querySelector(".back-button");
    backButton.addEventListener("click", () => {
        window.location.href = "/";
    });

    // ajax 로그인 (선택사항)
    const formLogin = document.getElementById("formLogin");

     formLogin.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        const csrfToken = document.querySelector('input[name="_csrf"]').value;

        try {
            const response = await fetch('/formLogin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: new URLSearchParams({
                    username: email,
                    password: password,
                })
            });

            if (response.redirected) {
                window.location.href = response.url;
            } else if (response.ok) {
                window.location.href = "/";
            } else {
                const text = await response.text();
                alert("로그인 실패: " + text);
            }
        } catch (error) {
            alert("서버와 통신 중 오류가 발생했습니다.");
            console.error(error);
        }
    });

    // 소셜 로그인 버튼 링크
    document.querySelector("#kakaoLoginBtn").addEventListener("click", () => {
        window.location.href = "/api/socialLogin/authorization/kakao";
    });
    document.querySelector("#naverLoginBtn").addEventListener("click", () => {
        window.location.href = "/api/socialLogin/authorization/naver";
    });
});
</script>
</body>
</html>
